{"version":3,"sources":["route/restaurant/Bill.js"],"names":["Title","styled","span","BillContainer","div","BillPaper","props","height","width","Button","button","blue","ButtonContainer","BillStyled","BillPaperStyled","billRef","data","eachItem","key","map","name","quantity","total","TimePassed","year","month","day","hour","minute","second","thatTime","Date","thisTime","console","log","diff","getTime","seconds","Math","floor","minutes","hours","numeral","format","CurrentDate","parseInt","ref","restaurant_name","style","marginBottom","table_number","length","marginTop","reduce","current","value","parseFloat","Bill","useAuthAPI","error","message","useRef","useEffect","window","localStorage","removeItem","result","screen","to","icon","faHome","onClick","overflow","html2canvas","scrollHeight","backgroundColor","then","canvas","location","href","toDataURL","replace","faSave"],"mappings":"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","file":"static/js/25.3521726f.chunk.js","sourcesContent":["import React, { Fragment, useEffect, useRef } from \"react\";\nimport { useAuthAPI } from \"../../utils/apiFetcher\";\nimport Loader from \"../../utils/Loader\";\nimport styled from \"styled-components\";\nimport numeral from \"numeral\";\nimport html2canvas from \"html2canvas\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\n\nimport { Link, Redirect } from \"react-router-dom\";\n\nimport { faHome, faSave } from \"@fortawesome/free-solid-svg-icons\";\n\nconst Title = styled.span`\n  font-size: 1.2em;\n  font-weight: bold;\n`;\n\nconst BillContainer = styled.div`\n  background-color: #232323;\n  color: white;\n  padding: 15px;\n  width: 100%;\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n`;\n\nconst BillPaper = styled.div`\n  height: ${(props) => props.height}px;\n  width: ${(props) => props.width}px;\n  // box-shadow: 0px 0px 15px 4px black;\n  margin: 15px 0;\n  overflow: auto;\n  display: flex;\n  flex-direction: column;\n  padding: 3px;\n  align-items: center;\n  font-size: calc(0.5vw + 0.5vh + 7px);\n  background-color: white;\n  color: black;\n  border-radius: 4px;\n`;\n\nconst Button = styled.button`\n  border: none;\n  border-radius: 3px;\n  background-color: ${(props) => (props.blue ? \"blue\" : \"green\")};\n  color: white;\n  padding: 5px 13px;\n  transition: all 0.3s;\n\n  &:hover {\n    background-color: ${(props) => (props.blue ? \"#000080\" : \"#002e00\")};\n    transition: all 0.3s;\n  }\n`;\n\nconst ButtonContainer = styled.div`\n  display: flex;\n  & > * {\n    margin: 5px;\n  }\n`;\n\nconst BillStyled = styled.div`\n  display: grid;\n  grid-template-columns: 1fr 1fr 1fr;\n  grid-auto-rows: min-content;\n  font-size: 0.8em;\n\n  margin-top: 20px;\n  width: 100%;\n  z-index: 1;\n  text-align: center;\n\n  span:nth-child(1),\n  span:nth-child(2),\n  span:nth-child(3) {\n    text-align: center !important;\n    font-weight: bold;\n  }\n`;\n\nfunction BillPaperStyled({ billRef, width, height, data }) {\n  const eachItem = [\n    <Fragment key={\"head\"}>\n      <span>ชื่อรายการ</span>\n      <span>จำนวน</span>\n      <span>รวม</span>\n    </Fragment>,\n    ...data.map((map) => {\n      const { name, quantity, total } = map;\n\n      return (\n        <Fragment key={name}>\n          <span>{name}</span>\n          <span>{quantity}</span>\n          <span>{total}</span>\n        </Fragment>\n      );\n    }),\n  ];\n\n  function TimePassed({ data }) {\n    const { year, month, day, hour, minute, second } = data;\n    let thatTime = new Date(year, month, day, hour, minute, second);\n    let thisTime = new Date();\n\n    console.log(thatTime, thisTime);\n\n    let diff = thisTime.getTime() - thatTime.getTime();\n\n    const seconds = Math.floor(diff / 1000);\n    const minutes = Math.floor(seconds / 60);\n    const hours = Math.floor(minutes / 60);\n\n    return (\n      <span>{`${hours}:${numeral(minutes - hours * 60).format(\"00\")}:${numeral(\n        seconds - minutes * 60\n      ).format(\"00\")}`}</span>\n    );\n  }\n\n  function CurrentDate({ data }) {\n    const { year, month, day, hour, minute, second } = data;\n    const monthList = [\n      \"มกราคม\",\n      \"กุมภาพันธ์\",\n      \"มีนาคม\",\n      \"เมษายน\",\n      \"พฤษภาคม\",\n      \"มิถุนายน\",\n      \"กรกฏาคม\",\n      \"สิงหาคม\",\n      \"กันยายน\",\n      \"ตุลาคม\",\n      \"พฤศจิกายน\",\n      \"ธันวาคม\",\n    ];\n\n    return (\n      <span>\n        {day} {monthList[month]} {parseInt(year) + 543}\n      </span>\n    );\n  }\n\n  return (\n    <BillPaper ref={billRef} width={width} height={height}>\n      <span>\n        <u>\n          <big>\n            <big>{data[0].restaurant_name}</big>\n          </big>\n        </u>\n      </span>\n      <small style={{ marginBottom: 8 }}>โต๊ะที่ {data[0].table_number}</small>\n      <small>\n        วันที่ <CurrentDate data={data[0]} />\n      </small>\n      <small>\n        ใช้เวลาทั้งหมด <TimePassed data={data[0]} />\n      </small>\n      <small>ทั้งหมด {data.length} รายการ</small>\n      <BillStyled>{eachItem}</BillStyled>\n      <span style={{ marginTop: 25 }}>\n        รวมทั้งสิ้น{\" \"}\n        {numeral(\n          data.reduce((current, value) => {\n            return current + parseFloat(value.total);\n          }, 0)\n        ).format(\"0,0.00\")}{\" \"}\n        บาท\n      </span>\n    </BillPaper>\n  );\n}\n\nfunction Bill() {\n  const { data, error } = useAuthAPI(`/restaurant/bill/get.php`);\n  const message = data?.message || \"loading\";\n  const billRef = useRef(null);\n  console.log(data);\n\n  useEffect(() => {\n    if (message === \"success\") window.localStorage.removeItem(\"auth\");\n  }, [message]);\n\n  function Save() {\n    billRef.current.style.overflow = \"visible\";\n    html2canvas(billRef.current, {\n      height: billRef.current.scrollHeight,\n      backgroundColor: \"#fff\",\n    }).then((canvas) => {\n      window.location.href = canvas\n        .toDataURL()\n        .replace(\"image/png\", \"image/octet-stream\");\n      billRef.current.style.overflow = \"auto\";\n    });\n  }\n\n  if (error) return error;\n  if (data?.message === \"success\") {\n    if (!data.result?.length) return <Redirect to=\"/\" />;\n    let width, height;\n    if (window.screen.width > window.screen.height) {\n      height = (window.screen.height / 100) * 80;\n      width = height * 1.4124 - height;\n    } else {\n      width = (window.screen.width / 100) * 80;\n      height = width * 1.4142;\n    }\n    return (\n      <BillContainer>\n        <Title>การชำระเสร็จสิ้น !</Title>\n        <span>ขอบคุณที่ใช้บริการ</span>\n        <BillPaperStyled\n          billRef={billRef}\n          width={width}\n          height={height}\n          data={data.result}\n        />\n        <ButtonContainer>\n          <Link to=\"/\">\n            <Button>\n              <FontAwesomeIcon icon={faHome} /> เสร็จสิ้น\n            </Button>\n          </Link>\n          <a onClick={Save}>\n            <Button blue>\n              <FontAwesomeIcon icon={faSave} /> บันทึก\n            </Button>\n          </a>\n        </ButtonContainer>\n      </BillContainer>\n    );\n  }\n  return <Loader />;\n}\n\nexport default Bill;\n"],"sourceRoot":""}