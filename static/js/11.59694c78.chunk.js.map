{"version":3,"sources":["utils/socket.io.js","route/restaurant/Restaurant.js","route/restaurant/Restaurant.module.css"],"names":["SOCKET_ADDRESS","SOCKET_PROTOCOL","SOCKET_ADDRESSES","SOCKET_PORT","createSocket","currentUser","io","query","method","uid","authentication","window","localStorage","getItem","socket","Socket","createContext","CatalogHeader","styled","div","SearchExpandAnimation","keyframes","SearchInput","input","attrs","props","type","placeholder","autoFocus","ConfirmMSG","span","Home","lazy","Cart","Catalog","NavBT","icon","title","url","to","className","RestaurantStyle","navBT","Restaurant","match","useRouteMatch","history","useHistory","useState","search","searchSet","connected","connectedSet","confirm","confirmSet","useEffect","a","authedFetcher","json","message","alert","removeItem","location","href","PROTOCOL","SERVER_ADDRESS","parseInt","result","timer","setInterval","clearInterval","on","table_number","push","Provider","value","container","header","path","onChange","event","target","style","color","faSearch","content","fallback","component","navigator","faScroll","faHome","faShoppingCart","module","exports"],"mappings":"gLAKMA,EAAc,UAAMC,IAAN,cAA2BC,IAA3B,YAA+CC,KAEnE,SAASC,EAAaC,GAkBpB,OAhBIA,EACOC,IAAGN,EAAgB,CAC1BO,MAAO,CACLC,OAAQ,UACRC,IAAKJ,EAAYI,OAIZH,IAAGN,EAAgB,CAC1BO,MAAO,CACLC,OAAQ,aACRE,eAAgBC,OAAOC,aAAaC,QAAQ,a,28BCWpD,IAAMC,EAASV,aAAa,GACtBW,EAASC,0BAETC,EAAgBC,IAAOC,IAAV,KAMbC,EAAwBC,YAAH,KASrBC,EAAcJ,IAAOK,MAAMC,OAAM,SAACC,GAAD,MAAY,CACjDC,KAAM,OACNC,YAAa,yDACbC,WAAW,KAHOV,CAAH,IAYFE,GAKTS,EAAaX,IAAOY,KAAV,KAQVC,EAAOC,gBAAK,kBAAM,kCAClBC,EAAOD,gBAAK,kBAAM,kCAClBE,EAAUF,gBAAK,kBAAM,kCA6G3B,SAASG,EAAT,GAAsC,IAArBC,EAAoB,EAApBA,KAAMC,EAAc,EAAdA,MAAOC,EAAO,EAAPA,IAC5B,OACE,kBAAC,IAAD,CAAMC,GAAID,GACR,yBAAKE,UAAWC,IAAgBC,OAC9B,kBAAC,IAAD,CAAiBN,KAAMA,IACtBC,IAMMM,UAtHf,WACE,IAAMC,EAAQC,cACRC,EAAUC,cAFI,EAGQC,mBAAS,IAHjB,mBAGbC,EAHa,KAGLC,EAHK,OAIcF,qBAAWlC,EAAOqC,WAJhC,mBAIbA,EAJa,KAIFC,EAJE,OAKUJ,mBAAS,GALnB,mBAKbK,EALa,KAKJC,EALI,KA4CpB,OArCAC,qBAAU,WAAM,4CACd,4BAAAC,EAAA,sEACqBC,YAAc,CAC/BnB,IAAI,qCAFR,OAKwB,mBAAd,QAJFoB,EADR,cAKU,IAAJA,OAAA,EAAAA,EAAMC,WACRC,MAAM,oJACNjD,OAAOC,aAAaiD,WAAW,QAC/BlD,OAAOmD,SAASC,KAAOC,IAAW,MAAQC,KAGtB,aAAd,OAAJP,QAAI,IAAJA,OAAA,EAAAA,EAAMC,UAA2D,IAAlCO,SAASR,EAAKS,OAAOd,UACtDC,EAAW,GAZf,4CADc,sBAgBd,GAAgB,IAAZD,EAAe,CACjB,IAAMe,EAAQC,aAjBD,WAAD,iCAiBuB,KACnC,OAAO,kBAAMC,cAAcF,QAI/BtD,EAAOyD,GAAG,WAAW,kBAAMnB,GAAa,MACxCtC,EAAOyD,GAAG,cAAc,kBAAMnB,GAAa,MAC3CtC,EAAOyD,GAAG,iBAAiB,kBAAMnB,GAAa,MAC9CtC,EAAOyD,GAAG,eAAV,uCAA0B,WAAOC,GAAP,eAAAhB,EAAA,sEACLC,YAAc,CAC/BnB,IAAI,qCAFkB,OAKF,mBAAd,QAJFoB,EADkB,cAKhB,IAAJA,OAAA,EAAAA,EAAMC,UAA6Bb,EAAQ2B,KAAR,SALf,2CAA1B,uDAYK9D,OAAOC,aAAaC,QAAQ,QAEjB,IAAZwC,EAEA,oCACE,kBAAC,IAAD,MACA,kBAACxB,EAAD,wIAGCsB,EACL,kBAACpC,EAAO2D,SAAR,CAAiBC,MAAO,CAAE7D,SAAQqC,cAChC,yBAAKX,UAAWC,IAAgBmC,WAC9B,yBAAKpC,UAAWC,IAAgBoC,QAC9B,kBAAC,IAAD,KACE,kBAAC,IAAD,CAAOC,KAAI,UAAKlC,EAAMkC,KAAX,UAAX,8CACA,kBAAC,IAAD,CAAOA,KAAI,UAAKlC,EAAMkC,KAAX,oBACT,kBAAC7D,EAAD,KACE,8FACA,kBAACK,EAAD,CAAaqD,MAAO1B,EAAQ8B,SAtB1C,SAA4BC,GAC1B9B,EAAU8B,EAAMC,OAAON,YAwBf,kBAAC,IAAD,CAAOG,KAAI,UAAKlC,EAAMkC,KAAX,aACT,kBAAC7D,EAAD,KACE,sEACA,kBAAC,IAAD,CACEiE,MAAO,CAAEC,MAAO,SAChB5C,GAAE,UAAKK,EAAMN,IAAX,oBAEF,kBAAC,IAAD,CAAiBF,KAAMgD,SAI7B,kBAAC,IAAD,CAAON,KAAI,UAAKlC,EAAMkC,OAAtB,gDAGJ,yBAAKtC,UAAWC,IAAgB4C,SAC9B,kBAAC,WAAD,CAAUC,SAAU,kBAAC,IAAD,OAClB,kBAAC,IAAD,KACE,kBAAC,IAAD,CAAOR,KAAI,UAAKlC,EAAMkC,KAAX,SAAwBS,UAAWtD,IAC9C,kBAAC,IAAD,CAAO6C,KAAI,UAAKlC,EAAMkC,KAAX,oBACT,kBAAC5C,EAAD,CAASe,OAAQA,KAEnB,kBAAC,IAAD,CAAO6B,KAAI,UAAKlC,EAAMkC,KAAX,YAA2BS,UAAWrD,IACjD,kBAAC,IAAD,CAAO4C,KAAI,UAAKlC,EAAMkC,MAAQS,UAAWxD,OAI/C,yBAAKS,UAAWC,IAAgB+C,WAC9B,kBAACrD,EAAD,CAAOC,KAAMqD,IAAUpD,MAAM,uCAASC,IAAG,UAAKM,EAAMN,IAAX,cACzC,kBAACH,EAAD,CAAOC,KAAMsD,IAAQrD,MAAM,6CAAUC,IAAG,UAAKM,EAAMN,OACnD,kBAACH,EAAD,CACEC,KAAMuD,IACNtD,MAAM,6CACNC,IAAG,UAAKM,EAAMN,IAAX,cAMX,kBAAC,IAAD,MA3D+C,kBAAC,IAAD,CAAUC,GAAG,Q,oBCzHhEqD,EAAOC,QAAU,CAAC,UAAY,8BAA8B,OAAS,2BAA2B,UAAY,8BAA8B,MAAQ,0BAA0B,QAAU,4BAA4B,cAAgB,kCAAkC,YAAc,gCAAgC,QAAU","file":"static/js/11.59694c78.chunk.js","sourcesContent":["import { useEffect, useState } from \"react\";\nimport io from \"socket.io-client\";\nimport { SOCKET_ADDRESS as SOCKET_ADDRESSES, SOCKET_PROTOCOL, SOCKET_PORT } from \"./config\";\n\n// process.env.NODE_TLS_REJECT_UNAUTHORIZED = \"0\";\nconst SOCKET_ADDRESS = `${SOCKET_PROTOCOL}://${SOCKET_ADDRESSES}:${SOCKET_PORT}`;\n\nfunction createSocket(currentUser) {\n  let socket;\n  if (currentUser) {\n    socket = io(SOCKET_ADDRESS, {\n      query: {\n        method: \"manager\",\n        uid: currentUser.uid,\n      },\n    });\n  } else {\n    socket = io(SOCKET_ADDRESS, {\n      query: {\n        method: \"restaurant\",\n        authentication: window.localStorage.getItem(\"auth\"),\n      },\n    });\n  }\n\n  return socket;\n}\n\nfunction useOrder(restaurant_id, handler) {\n  const [socket] = useState(\n    io(SOCKET_ADDRESS, {\n      query: {\n        method: \"manager\",\n        restaurant_id,\n      },\n    })\n  );\n  const [connected, setState] = useState(false);\n\n  useEffect(() => {\n    socket.open();\n    socket.on(\"order\", handler);\n    socket.on(\"connect\", () => setState(true));\n    socket.on(\"disconnect\", () => setState(false));\n    socket.on(\"connect_error\", () => setState(false));\n    return () => {\n      socket.close();\n    };\n  }, [handler, socket]);\n\n  return { socket, connected };\n}\n\nfunction useUpdate(handler) {\n  const [socket] = useState(\n    io(SOCKET_ADDRESS, {\n      query: {\n        method: \"restaurant\",\n        authentication: window.localStorage.getItem(\"auth\"),\n      },\n    })\n  );\n  const [connected, setState] = useState(false);\n\n  useEffect(() => {\n    socket.open();\n    socket.on(\"update\", handler);\n    socket.on(\"connect\", () => setState(true));\n    socket.on(\"disconnect\", () => setState(false));\n    socket.on(\"connect_error\", () => setState(false));\n    return () => {\n      socket.close();\n    };\n  }, [handler, socket]);\n\n  return { socket, connected };\n}\n\nexport { useOrder, useUpdate, createSocket };\n","import React, {\n  Suspense,\n  lazy,\n  useState,\n  createContext,\n  useEffect,\n} from \"react\";\nimport {\n  faHome,\n  faShoppingCart,\n  faScroll,\n  faSearch,\n} from \"@fortawesome/free-solid-svg-icons\";\nimport RestaurantStyle from \"./Restaurant.module.css\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport {\n  Switch,\n  Route,\n  Link,\n  useRouteMatch,\n  Redirect,\n  useHistory,\n} from \"react-router-dom\";\nimport Loader from \"../../utils/Loader\";\nimport styled, { keyframes } from \"styled-components\";\nimport { createSocket } from \"../../utils/socket.io\";\n\nimport { authedFetcher } from \"../../utils/apiFetcher\";\n\nimport { PROTOCOL, SERVER_ADDRESS } from \"../../utils/config\";\n\nconst socket = createSocket(false);\nconst Socket = createContext();\n\nconst CatalogHeader = styled.div`\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n`;\n\nconst SearchExpandAnimation = keyframes`\n\tfrom {\n\t\twidth: 0%;\n\t}\n\tto {\n\t\twidth: 50%;\n\t}\n`;\n\nconst SearchInput = styled.input.attrs((props) => ({\n  type: \"text\",\n  placeholder: \"ชื่ออาหาร\",\n  autoFocus: true,\n}))`\n  padding: 5px;\n  width: 50%;\n  border: 2px white solid;\n  background-color: transparent;\n  color: white;\n  border-radius: 3px;\n  margin-left: auto;\n  animation: ${SearchExpandAnimation} 0.8s;\n  position: absolute;\n  right: 10px;\n`;\n\nconst ConfirmMSG = styled.span`\n  font-size: 1em;\n  position: absolute;\n  top: 53%;\n  left: 50%;\n  transform: translate(-50%);\n`;\n\nconst Home = lazy(() => import(\"./Home\"));\nconst Cart = lazy(() => import(\"./Cart\"));\nconst Catalog = lazy(() => import(\"./Catalog\"));\n\nfunction Restaurant() {\n  const match = useRouteMatch();\n  const history = useHistory();\n  const [search, searchSet] = useState(\"\");\n  const [connected, connectedSet] = useState(!!socket.connected);\n  const [confirm, confirmSet] = useState(0);\n\n  useEffect(() => {\n    async function fetcher() {\n      const json = await authedFetcher({\n        url: `/restaurant/sessions/confirm.php`,\n      });\n\n      if (json?.message === \"session ended\") {\n        alert(\"ถูกยกเลิกโดยทางร้านอาหาร\");\n        window.localStorage.removeItem(\"auth\");\n        window.location.href = PROTOCOL + \"://\" + SERVER_ADDRESS;\n      }\n\n      if (json?.message === \"success\" && parseInt(json.result.confirm) === 1)\n        confirmSet(1);\n    }\n\n    if (confirm === 0) {\n      const timer = setInterval(fetcher, 1000);\n      return () => clearInterval(timer);\n    }\n  });\n\n  socket.on(\"connect\", () => connectedSet(true));\n  socket.on(\"disconnect\", () => connectedSet(false));\n  socket.on(\"connect_error\", () => connectedSet(false));\n  socket.on(\"completeBill\", async (table_number) => {\n    const json = await authedFetcher({\n      url: `/restaurant/get_table_number.php`,\n    });\n\n    if (json?.message === \"session ended\") history.push(`/bill`);\n  });\n\n  function handleSearchChange(event) {\n    searchSet(event.target.value);\n  }\n\n  if (!window.localStorage.getItem(\"auth\")) return <Redirect to=\"/\" />;\n\n  if (confirm === 0)\n    return (\n      <>\n        <Loader />\n        <ConfirmMSG>รอการยืนยันจากทางร้าน</ConfirmMSG>\n      </>\n    );\n  return connected ? (\n    <Socket.Provider value={{ socket, connected }}>\n      <div className={RestaurantStyle.container}>\n        <div className={RestaurantStyle.header}>\n          <Switch>\n            <Route path={`${match.path}/cart`}>ตระกร้า</Route>\n            <Route path={`${match.path}/catalog/search`}>\n              <CatalogHeader>\n                <span>ค้นหาอาหาร</span>\n                <SearchInput value={search} onChange={handleSearchChange} />\n              </CatalogHeader>\n            </Route>\n            <Route path={`${match.path}/catalog`}>\n              <CatalogHeader>\n                <span>รายการ</span>\n                <Link\n                  style={{ color: \"white\" }}\n                  to={`${match.url}/catalog/search`}\n                >\n                  <FontAwesomeIcon icon={faSearch} />\n                </Link>\n              </CatalogHeader>\n            </Route>\n            <Route path={`${match.path}`}>หน้าแรก</Route>\n          </Switch>\n        </div>\n        <div className={RestaurantStyle.content}>\n          <Suspense fallback={<Loader />}>\n            <Switch>\n              <Route path={`${match.path}/cart`} component={Cart} />\n              <Route path={`${match.path}/catalog/search`}>\n                <Catalog search={search} />\n              </Route>\n              <Route path={`${match.path}/catalog`} component={Catalog} />\n              <Route path={`${match.path}`} component={Home} />\n            </Switch>\n          </Suspense>\n        </div>\n        <div className={RestaurantStyle.navigator}>\n          <NavBT icon={faScroll} title=\"รายการ\" url={`${match.url}/catalog`} />\n          <NavBT icon={faHome} title=\"หน้าแรก\" url={`${match.url}`} />\n          <NavBT\n            icon={faShoppingCart}\n            title=\"ตระกร้า\"\n            url={`${match.url}/cart`}\n          />\n        </div>\n      </div>\n    </Socket.Provider>\n  ) : (\n    <Loader />\n  );\n}\n\nfunction NavBT({ icon, title, url }) {\n  return (\n    <Link to={url}>\n      <div className={RestaurantStyle.navBT}>\n        <FontAwesomeIcon icon={icon} />\n        {title}\n      </div>\n    </Link>\n  );\n}\n\nexport default Restaurant;\nexport { Socket };\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"Restaurant_container__fOKtj\",\"header\":\"Restaurant_header__Y1P8S\",\"navigator\":\"Restaurant_navigator__2yGFV\",\"navBT\":\"Restaurant_navBT__qycDx\",\"content\":\"Restaurant_content__gnv30\",\"homeContainer\":\"Restaurant_homeContainer__1v34V\",\"popularFood\":\"Restaurant_popularFood__1XXuE\",\"seeMore\":\"Restaurant_seeMore__kl58q\"};"],"sourceRoot":""}